<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MyTasks</title>
    <!--<link rel="stylesheet" type="text/css" href="/style.css">-->
    <link href="/webjars/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet"/>
</head>

<body style="background: #343a40!important; padding-top: 70px">
<nav class="navbar navbar-expand-md fixed-top bg-dark">
    <form name="searchForm" action="/" th:method="get" style="vertical-align: bottom">
        <select name="owner" id="owner" style="display: inline">
            <option value="0" selected disabled hidden>Select owner</option>
            <option th:each="owner : ${owners}"
                    th:text="${owner}"
                    th:value="${owner}"
                    th:selected="${owner.equals(selectedOwner)}">
            </option>
        </select>
        <select name=project id="project" style="display: inline">
            <option value="0" selected disabled hidden>Select project</option>
            <option th:each="project : ${projects}"
                    th:text="${project}"
                    th:value="${project}"
                    th:selected="${project.equals(selectedProject)}">
            </option>
        </select>
        <select name=context id="context" style="display: inline">
            <option value="0" selected disabled hidden>Select context</option>
            <option th:each="context : ${contexts}"
                    th:text="${context}"
                    th:value="${context}"
                    th:selected="${context.equals(selectedContext)}">
            </option>
        </select>
        <input style="font-size: 13px; display: inline; padding: 2px 8px; vertical-align: top"
               class="btn btn-outline-primary my-0 my-sm0 justify-content-center btn-sm"
               type="submit"
               value="Search">
    </form>
    <label style="color: lightgray; margin: 4px 8px 4px 14px" th:text="${items}"/>
    <label style="color: lightgray; margin: 3px 6px 0px 0px; font-size: 13px" >items found</label>>


    <div class="collapse navbar-collapse" style="display: flex; justify-content: flex-end">
        <ul class="nav navbar-nav d-block">
            <li class="nav-item">
                <a class="btn-link" th:href="@{/settings}" th:text="settings"/>
            </li>
            <li class="nav-item d-block">
                <a style="font-size: 13px" class="btn btn-outline-warning my-0 my-sm0 d-flex btn-sm"
                   th:href="@{|/todo/add|}">Add new task</a>
            </li>
        </ul>
    </div>
</nav>


<div class="table-responsive">
    <table class="table table-striped table-dark table-hover table-bordered"
            style="font-size: 13px; width: 100%; height: 100%">
            <!-- add: margin-top: 43px-->
        <thead class="bg-secondary"
            style="top: 68px; width: 100%">
        <!-- add: style="position:fixed ...-->
        <tr>
            <th class="text-center" scope="col">ID</th>
            <th>TITLE</th>
            <th>OWNER</th>
            <th>PROJECT</th>
            <th>CONTEXT</th>
            <th>DUE DATE</th>
            <th>PRIORITY</th>
            <th>STATUS</th>
            <th></th>
            <th></th>
        </tr>
        </thead>
        <tr th:each="todo : ${todos}">
            <td class="text-center my-0 my-sm0"
                th:style="'padding: 4px;' + (${todo.getStatus().ordinal()} == 4 ? 'color: gray' : 'color: white')"
                th:text="${todo.getId()}"/>
            <td th:style="'padding: 4px'">
                <a th:style="${todo.getStatus().ordinal()} == 4 ? 'color: gray' : 'color: cornflowerblue'"
                   th:href="@{|/todo/${todo.getId()}/edit|}"
                   th:text="${todo.getTitle()}"
                   th:title="${todo.getDescription()}">
                </a>
                <a th:if="${todo.hasLink()} == true" target="_blank"
                   th:style="${todo.getStatus().ordinal()} == 4 ? 'color: gray' : 'color: cornflowerblue' + '; letter-spacing: -2px'"
                   th:href="@{${todo.getLink()}}">>>>
                </a>
            </td>
            <td th:style="'padding: 4px;' + (${todo.getStatus().ordinal()} == 4 ? 'color: gray' :
             (${todo.getOwner().getId()} == 2 ? 'color:#A6F8DD' : 'color: white'))"
                th:text="${todo.getOwner().getName()}"/>
            <td th:style="'padding: 4px;' + (${todo.getStatus().ordinal()} == 4 ? 'color: gray' : 'color: white')"
                th:text="${todo.getProject()}"/>
            <td th:style="'padding: 4px;' + (${todo.getStatus().ordinal()} == 4 ? 'color: gray' : 'color: white')"
                th:text="${todo.getContext()}"/>
            <td th:style="'padding: 4px;' + (${todo.getStatus().ordinal()} == 4 ? 'color: gray' : 'color: white')"
                th:text="${todo.getDisplayDueDate()} "/>
            <td th:style="'padding: 4px;' +
                (${todo.getStatus().ordinal()} == 4 ? 'color: gray;' :
                (${todo.getPrio().ordinal()} == 0 ? 'color: red' :
                (${todo.getPrio().ordinal()} == 1 ? 'color: orange' :
                (${todo.getPrio().ordinal()} == 2 ? 'color: yellow' :
                (${todo.getPrio().ordinal()} == 3 ? 'color: lime' : 'color: gray')))))"
                th:text="${todo.getPrio()}"/>
            <td th:style="'padding: 4px;' + (${todo.getStatus().ordinal()} == 4 ? 'color: gray' : 'color: white')"
                th:text="${todo.getStatus()}"/>
            <td class="text-center my-0 my-sm0" style="padding: 1px 4px">
                <form action="#" th:method="post">
                    <input style="font-size: 13px" th:disabled="${todo.getStatus().ordinal()} == 4"
                           class="btn btn-outline-success my-0 my-sm0 d-flex justify-content-center btn-sm btn-block"
                           type="button"
                           th:onclick="'javascript:document.location=\'/todo/id/'+${todo.getId()}+'/owner/\'+document.getElementById(\'owner\').value+\'/project/\'+document.getElementById(\'project\').value+\'/context/\'+document.getElementById(\'context\').value+\'/done\''"
                           value="Done">
                </form>
            </td>
            <td class="text-center my-0 my-sm0" style="padding: 1px 4px">
                <input style="font-size: 13px"
                       class="btn btn-outline-danger my-0 my-sm0 d-flex justify-content-center btn-sm btn-block"
                       data-toggle="modal"
                       th:data-target="'#myModal'+${todo.getId()}"
                       type="button"
                       value="Delete">

                <!-- Modal dialog -->
                <!-- TODO: move it to a fragment-->
                <!--https://getbootstrap.com/docs/3.4/javascript/-->
                <!--https://www.youtube.com/watch?v=St4-x9Cz04A-->
                <!--<form action="#" th:action="@{|/todo/${todo.getId()}/delete|}" th:method="delete">-->
                <div class="modal fade modal-delete" th:id="'myModal'+${todo.getId()}" role="dialog">
                    <div class="modal-dialog modal-sm" role="document">
                        <div class="modal-content">
                            <div class="modal-body my-0 my-sm0 bg-dark" style="color: white; font-size: 13px">
                                Do you really want to delete this task?
                            </div>
                            <div class="modal-footer bg-dark" style="color: white">
                                <button style="font-size: 13px" type="button"
                                        class="btn my-0 my-sm0 btn-dark" data-dismiss="modal">Cancel</button>
                                <!--<input style="font-size: 13px"
                                       class="btn btn-outline-danger my-0 my-sm0 d-flex btn-sm"
                                       type="submit"
                                       value="Delete">-->
                                <a href="javascript:void(0);"
                                   th:onclick="'javascript:document.location=\'/todo/id/'+${todo.getId()}+'/owner/\'+document.getElementById(\'owner\').value+\'/project/\'+document.getElementById(\'project\').value+\'/context/\'+document.getElementById(\'context\').value+\'/delete\''">
                                    <span class="btn btn-danger" value="delete">Delete</span></a>
                            </div>
                        </div>
                    </div>
                </div>
                <!--</form>-->
            </td>
        </tr>
    </table>
</div>
</body>
<script src="/webjars/jquery/3.3.1/jquery.min.js"></script>
<script src="/webjars/bootstrap/4.3.1/js/bootstrap.bundle.js"></script>
</body>
</html>